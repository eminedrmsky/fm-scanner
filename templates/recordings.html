{% extends 'base.html' %}
{% block content %}

<hr>
<section class="container-fluid" style="background-color:rgb(255, 255, 255);">
    <div class="alert alert-light" role="alert">
        <div class="container">
            <div class="row justify-content-md-center">
                <div class="d-flex flex-row w-75 mx-auto">
                    <div class="col">
                    <form action="#" method="post">
                        <div class="row" >
                            <div class='row' style="margin-left: 19px;"> From:</div>
                                <input type="date" name="from_Date"  style="margin-left: 30px; font-size: 20px; width:400px; " 
                                placeholder="From_Date" id="From_Date" required="" > 
                            <div class='row' style="margin-left: 19px;">  To:</div>
                            <input type="date" name="to_Date" style="margin-left: 30px;font-size: 20px; width:400px;" 
                                placeholder="To_Date" id="To_Date" required="" > 
                        </div>
                        <hr>
                        <div class="row" >
                            <input type="submit" value="Apply" id="Apply" style=" width:90px; 
                                height:45px; margin-left: 40px; margin-bottom: 30px;"
                                class="btn btn-outline-dark">
                        </form>
                            <a class="btn btn-outline-dark" style=" width:90px; 
                                        height:45px;margin-left: 10px; margin-bottom: 30px;"
                                href="{{ url_for('showRecords') }}">Reset</a>
                        </div>
                    </div>
                <div class="col" style="margin-left: 350px;">
                    <a href="/home/pi/fm-scanner/fm-scanner/static/media/example.csv" download="csv" class="hoverable2">

                        <span class="hoverable2__main"></span>
                            <img src="/static/media/logo/csv.jpg" alt="" width="150" height="150">
                        </span>
                        <span class="hoverable2__tooltip">
                            Download data recorded between chosen dates as CSV file <br>
                        </span>
                      </a>
                      <input class="btn btn-outline-dark" type="submit" id="indir" name="indir"
                      value="indir" onclick="get()">
                    </input>
                </div>
            </div>

                <table id = "recordings" class="table table-borderless table-responsive">
                    <thead>
                    <tr class="border-bottom text-center">
                        <th scope="col">İsim </th>
                        <th scope="col">Gösterim</th>
                        <th scope="col">Uzunluk </th>
                        <th scope="col">Açıklama</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for hist in hists %}
                    <tr class="border-bottom text-center">
                        <td>{{hist.name}}</td>
                        {% set file_name = hist.name +'.wav' %}
                        <td>
                            <audio controls>
                                <source src="{{ url_for( 'static' , filename= file_name ) }}" type="audio/wav">
                            </audio>
                        </td>
                        {% set second = hist.length%60 %}
                        {% set minute = (hist.length-second)/60 %}
                        <td>{{minute}} dk {{second}} sn</td>
                        <td class="hoverable">
                            
                            <span class="hoverable__main">
                                data is here
                            </span>
                            <span class="hoverable__tooltip">
                                {{hist.info}} <br>
                            </span>

                        </td>
                    </tr>
                    {%endfor%}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<style>
    .hoverable{
        position: relative;
    }

    .hoverable>.hoverable__tooltip{
        display: none;

        }

    .hoverable:hover>.hoverable__tooltip{
            display: inline;
            position: absolute;
            z-index: 1;
            left: 0;
            top: 30%;
            background-color: rgb(66, 66, 66);
            color: #fff;
            text-align: center;
            border-radius: 5px 5px;
            transition: opacity 1s ease-in-out;
        
        }

    .hoverable2{
        position: relative;
    }

    .hoverable2>.hoverable2__tooltip{
        display: none;

        }

    .hoverable2:hover>.hoverable2__tooltip{
            display: inline;
            position: absolute;
            z-index: 1;
            left: 15px;
            top: 300%;
            background-color: rgb(179, 255, 182);
            color: rgb(0, 163, 238);
            text-align: center;
            border-radius: 10px 10px;
            transition: opacity 1s ease-in-out;
        
        }


        
</style>

<script>
    
        const download = function (data) {
        
            // Creating a Blob for having a csv file format
            // and passing the data with type
            const blob = new Blob([data], { type: 'text/csv' });

            // Creating an object for downloading url
            const url = window.URL.createObjectURL(blob)

            // Creating an anchor(a) tag of HTML
            const a = document.createElement('a')

            // Passing the blob downloading url
            a.setAttribute('href', url)

            // Setting the anchor tag attribute for downloading
            // and passing the download file name
            a.setAttribute('download', 'download.csv');

            // Performing a download with click
            a.click()
        }

        const csvmaker = function (data) {

            // Empty array for storing the values
            csvRows = [];

            // Headers is basically a keys of an
            // object which is id, name, and
            // profession
            const headers = ['name', 'length', 'info'];

            // As for making csv format, headers
            // must be separated by comma and
            // pushing it into array
            csvRows.push(headers.join(','));

            // Pushing Object values into array
            // with comma separation
            const values = Object.values(data).join(',');
            csvRows.push(values)

            // Returning the array joining with new line
            return csvRows.join('\n')
        }

        const get = async function () {
            var data = '{{hists}}'
            const csvdata = csvmaker(data);
            download(csvdata);
        }

    
</script>

{% endblock %}